import{_ as z,r as v,c as G,o as Q,a as m,b as e,d as R,e as S,w as B,f as K,g as E,v as L,h as y,t as p,n as Y,i as W,j as X,k as Z,F as I,l as T,m as w}from"./index-L-pWWLOX.js";const ee=s=>{const r=JSON.stringify(s),a=new TextEncoder().encode(r);return new Blob([a],{type:"application/vnd.sqlite3"})},te=async s=>new Promise((r,o)=>{const a=new FileReader;a.onload=l=>{try{const c=l.target.result,u=JSON.parse(c);r(u)}catch{o(new Error("Invalid database file format. Expected valid JSON."))}},a.onerror=()=>o(new Error("Failed to read database file")),a.readAsText(s)}),oe=s=>{const r=ee(s);return URL.createObjectURL(r)},ae=(s,r="database.db")=>{const o=oe(s),a=document.createElement("a");a.href=o,a.download=r,document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a),URL.revokeObjectURL(o)},100)},g=[{id:1,name:"John Doe",email:"john@example.com",role:"Admin"},{id:2,name:"Jane Smith",email:"jane@example.com",role:"User"},{id:3,name:"Mike Johnson",email:"mike@example.com",role:"Editor"}],re="app-data.db",_="dbFileCache",h=async()=>new Promise(s=>{try{if(typeof window<"u"){const r=localStorage.getItem(_);if(r){s(JSON.parse(r));return}localStorage.setItem(_,JSON.stringify(g)),s(g)}else s(g)}catch(r){console.error("Error reading database file:",r),s([])}}),k=async s=>new Promise(r=>{try{typeof window<"u"&&localStorage.setItem(_,JSON.stringify(s)),r(!0)}catch(o){console.error("Error writing database file:",o),r(!1)}}),se=async()=>new Promise(s=>{setTimeout(async()=>{const r=await h();s(r)},600)}),ne=async s=>new Promise((r,o)=>{setTimeout(async()=>{try{const a=await h(),c={id:a.length>0?Math.max(...a.map(u=>u.id))+1:1,...s};a.push(c),await k(a),r(c)}catch(a){console.error("Error adding record:",a),o(new Error("Failed to add record"))}},400)}),le=async(s,r)=>new Promise((o,a)=>{setTimeout(async()=>{try{const l=await h(),c=l.findIndex(f=>f.id===s);if(c===-1){a(new Error(`Record with ID ${s} not found`));return}const u={id:s,...r};l[c]=u,await k(l),o(u)}catch(l){console.error("Error updating record:",l),a(new Error("Failed to update record"))}},400)}),ie=async s=>new Promise((r,o)=>{setTimeout(async()=>{try{const a=await h(),l=a.filter(c=>c.id!==s);if(a.length===l.length){o(new Error(`Record with ID ${s} not found`));return}await k(l),r(!0)}catch(a){console.error("Error deleting record:",a),o(new Error("Failed to delete record"))}},400)}),de=async()=>new Promise((s,r)=>{setTimeout(async()=>{try{const o=await h();if(!o||o.length===0){r(new Error("No data to export"));return}ae(o,re),s()}catch(o){console.error("Error exporting database:",o),r(new Error("Failed to export database"))}},400)}),ue=async s=>new Promise((r,o)=>{setTimeout(async()=>{try{const a=await te(s);if(!Array.isArray(a)){o(new Error("Invalid database format, expected array"));return}await k(a),r(a)}catch(a){console.error("Error importing database:",a),o(new Error("Failed to import database: "+a.message))}},400)}),ce=async()=>new Promise(async s=>{setTimeout(async()=>{await k(g),s(g)},400)}),ve={class:"db-container"},me={class:"db-content"},we={class:"db-header"},pe={class:"nav-buttons"},fe={class:"controls"},ye={class:"search-box"},be={class:"action-buttons"},ge={key:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},he={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},ke=["disabled"],xe=["disabled"],Ce={key:1,class:"form-container"},Ee={class:"form-group"},De={class:"form-group"},Me={class:"form-group"},Le={class:"form-actions"},_e={type:"submit",class:"submit-button"},Ae={key:2,class:"loading"},Fe={key:3,class:"no-data"},Re={key:4,class:"table-container"},Se={class:"id-column"},Be={class:"actions"},Ie=["onClick"],Te=["onClick"],je={__name:"LocalDatabase",setup(s){const r=v([]),o=v({name:"",email:"",role:""}),a=v(["ID","Name","Email","Role","Actions"]),l=v(!1),c=v(""),u=v(!1),f=v(!1),x=v(null),d=v(""),A=v(null),D=v(!1),M=v(!1),b=async()=>{l.value=!0;try{r.value=await se(),d.value=""}catch(n){console.error("Error loading data:",n),d.value="Failed to load data"}finally{l.value=!1}},j=async()=>{if(!o.value.name||!o.value.email||!o.value.role){d.value="All fields are required";return}l.value=!0;try{await ne(o.value),await b(),o.value={name:"",email:"",role:""},u.value=!1,d.value="Record added successfully"}catch(n){d.value=n.message||"Failed to add record"}finally{l.value=!1}},V=n=>{o.value={name:n.name,email:n.email,role:n.role},x.value=n.id,f.value=!0,u.value=!0},N=async()=>{if(!o.value.name||!o.value.email||!o.value.role){d.value="All fields are required";return}l.value=!0;try{await le(x.value,o.value),await b(),o.value={name:"",email:"",role:""},f.value=!1,u.value=!1,x.value=null,d.value="Record updated successfully"}catch(n){d.value=n.message||"Failed to update record"}finally{l.value=!1}},U=async n=>{if(confirm("Are you sure you want to delete this record?")){l.value=!0;try{await ie(n),await b(),d.value="Record deleted successfully"}catch(t){d.value=t.message||"Failed to delete record"}finally{l.value=!1}}},J=async()=>{if(confirm("Are you sure you want to reset the database? All data will be lost.")){l.value=!0;try{await ce(),await b(),d.value="Database reset successfully"}catch(n){d.value=n.message||"Failed to reset database"}finally{l.value=!1}}},O=async()=>{D.value=!0;try{const n=await de(),t=document.createElement("a");t.href=n,t.download="database_export.json",document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n),d.value="Database exported successfully"}catch(n){d.value=n.message||"Failed to export database"}finally{D.value=!1}},P=()=>{A.value.click()},$=async n=>{const t=n.target.files[0];if(t){M.value=!0;try{await ue(t),await b(),d.value="Database imported successfully"}catch(C){d.value=C.message||"Failed to import database"}finally{M.value=!1,n.target.value=null}}},F=G(()=>{if(!c.value)return r.value;const n=c.value.toLowerCase();return r.value.filter(t=>t.name.toLowerCase().includes(n)||t.email.toLowerCase().includes(n)||t.role.toLowerCase().includes(n))}),q=()=>{o.value={name:"",email:"",role:""},f.value=!1,u.value=!1,x.value=null};return Q(()=>{b()}),(n,t)=>{const C=K("router-link");return w(),m("div",ve,[e("div",me,[e("header",we,[t[8]||(t[8]=e("div",{class:"header-left"},[e("h1",null,"Локальная БД"),e("span",{class:"subtitle"},"Управление локальным хранилищем с использованием .db файлов")],-1)),e("div",pe,[S(C,{to:"/",class:"nav-button"},{default:B(()=>t[6]||(t[6]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})],-1),y(" Главная ")])),_:1,__:[6]}),S(C,{to:"/database/mysql",class:"nav-button"},{default:B(()=>t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})],-1),y(" MySQL БД ")])),_:1,__:[7]})])]),e("div",fe,[e("div",ye,[t[9]||(t[9]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"search-icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})],-1)),E(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=i=>c.value=i),placeholder:"Поиск записей...",class:"search-input"},null,512),[[L,c.value]])]),e("div",be,[e("button",{onClick:t[1]||(t[1]=i=>u.value=!u.value),class:"action-button"},[u.value?(w(),m("svg",he,t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"},null,-1)]))):(w(),m("svg",ge,t[10]||(t[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"},null,-1)]))),y(" "+p(u.value?"Отмена":"Добавить запись"),1)]),e("button",{onClick:P,class:"secondary-button",disabled:M.value},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-13.5-9L12 3m0 0l4.5 4.5M12 3v13.5"})],-1),y(" Импорт .db файла ")]),8,ke),e("input",{type:"file",ref_key:"fileInput",ref:A,onChange:$,accept:".db",style:{display:"none"}},null,544),e("button",{onClick:O,class:"secondary-button",disabled:D.value},t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})],-1),y(" Создать .db файл ")]),8,xe),e("button",{onClick:J,class:"danger-button"},t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})],-1),y(" Сбросить ")]))])]),d.value?(w(),m("div",{key:0,class:Y(["status-message",{success:d.value.includes("success")}])},p(d.value),3)):R("",!0),u.value?(w(),m("div",Ce,[e("h2",null,p(f.value?"Редактировать запись":"Добавить новую запись"),1),e("form",{onSubmit:t[5]||(t[5]=W(i=>f.value?N():j(),["prevent"]))},[e("div",Ee,[t[15]||(t[15]=e("label",{for:"name"},"Имя",-1)),E(e("input",{id:"name",type:"text","onUpdate:modelValue":t[2]||(t[2]=i=>o.value.name=i),required:""},null,512),[[L,o.value.name]])]),e("div",De,[t[16]||(t[16]=e("label",{for:"email"},"Email",-1)),E(e("input",{id:"email",type:"email","onUpdate:modelValue":t[3]||(t[3]=i=>o.value.email=i),required:""},null,512),[[L,o.value.email]])]),e("div",Me,[t[18]||(t[18]=e("label",{for:"role"},"Роль",-1)),E(e("select",{id:"role","onUpdate:modelValue":t[4]||(t[4]=i=>o.value.role=i),required:""},t[17]||(t[17]=[Z('<option value="" data-v-d1395307>Выберите роль</option><option value="Admin" data-v-d1395307>Администратор</option><option value="User" data-v-d1395307>Пользователь</option><option value="Editor" data-v-d1395307>Редактор</option><option value="Guest" data-v-d1395307>Гость</option>',5)]),512),[[X,o.value.role]])]),e("div",Le,[e("button",{type:"button",onClick:q,class:"cancel-button"},"Отмена"),e("button",_e,p(f.value?"Обновить":"Сохранить"),1)])],32)])):R("",!0),t[23]||(t[23]=e("div",{class:"db-info"},[e("div",{class:"info-panel"},[e("h3",null,"О работе с .db файлами"),e("p",null,' Данные хранятся локально в браузере, но могут быть экспортированы в .db файл для переноса или резервного копирования. Используйте кнопку "Создать .db файл" для экспорта текущих данных и "Импорт .db файла" для загрузки данных из .db файла. ')])],-1)),l.value?(w(),m("div",Ae,t[19]||(t[19]=[e("svg",{class:"spinner",viewBox:"0 0 50 50"},[e("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"})],-1),y(" Загрузка... ")]))):F.value.length===0?(w(),m("div",Fe,t[20]||(t[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"empty-icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m6 4.125l2.25 2.25m0 0l2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z"})],-1),y(" Записи не найдены ")]))):(w(),m("div",Re,[e("table",null,[e("thead",null,[e("tr",null,[(w(!0),m(I,null,T(a.value,i=>(w(),m("th",{key:i},p(i),1))),128))])]),e("tbody",null,[(w(!0),m(I,null,T(F.value,i=>(w(),m("tr",{key:i.id},[e("td",Se,p(i.id),1),e("td",null,p(i.name),1),e("td",null,p(i.email),1),e("td",null,p(i.role),1),e("td",Be,[e("button",{onClick:H=>V(i),class:"edit-button",title:"Редактировать"},t[21]||(t[21]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"})],-1)]),8,Ie),e("button",{onClick:H=>U(i.id),class:"delete-button",title:"Удалить"},t[22]||(t[22]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})],-1)]),8,Te)])]))),128))])])]))])])}}},Ne=z(je,[["__scopeId","data-v-d1395307"]]);export{Ne as default};
